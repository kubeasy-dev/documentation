---
title: How it Works
description: Understand the technical architecture behind Kubeasy - from CLI to cluster validation.
---

Kubeasy combines several open-source tools to create an isolated, validated learning environment entirely on your machine.

This page explains the technical architecture and how each component interacts.

## Architecture Overview

```
┌─────────────────────────────────────────────────────────────┐
│                        Your Machine                          │
│                                                               │
│  ┌──────────────┐                                            │
│  │ Kubeasy CLI  │  (Go + Cobra)                              │
│  │   Manages    │                                            │
│  │   Validates  │                                            │
│  └──────┬───────┘                                            │
│         │                                                     │
│         │ Creates & Queries                                   │
│         ▼                                                     │
│  ┌─────────────────────────────────────────────────────────┐│
│  │            Kind Cluster (Local K8s)                      ││
│  │                                                           ││
│  │  ┌──────────────┐  ┌──────────────┐                     ││
│  │  │   ArgoCD     │  │   Kyverno    │                     ││
│  │  │              │  │              │                     ││
│  │  │ Deploys      │  │ Prevents     │                     ││
│  │  │ Challenges   │  │ Bypasses     │                     ││
│  │  └──────────────┘  └──────────────┘                     ││
│  │                                                           ││
│  │  ┌─────────────────────────────────────────────────────┐││
│  │  │  Challenge Namespaces (isolated)                    │││
│  │  │  • challenge-pod-evicted                            │││
│  │  │  • challenge-rbac-basics                            │││
│  │  │  • ...                                               │││
│  │  └─────────────────────────────────────────────────────┘││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

## Component Breakdown

### 1. Kubeasy CLI

The CLI is built with **Go** and uses the **Cobra** framework for command-line parsing.

**Responsibilities:**
- Authenticates users via API tokens
- Sets up the local Kind cluster
- Deploys infrastructure components (ArgoCD, Kyverno)
- Starts/stops/resets challenges
- **Executes validations** directly against the cluster
- Submits results to the Kubeasy platform

**Key Commands:**
```bash
kubeasy init              # Bootstrap the local cluster
kubeasy challenge start   # Deploy challenge manifests
kubeasy challenge submit  # Run validations and submit results
kubeasy challenge reset   # Clean up and restart
```

### 2. Kind (Kubernetes in Docker)

[Kind](https://kind.sigs.k8s.io/) creates a local, lightweight Kubernetes cluster running entirely in Docker containers.

**Why Kind?**
- Fast cluster creation (~30 seconds)
- Completely isolated from your system
- No cloud dependencies
- Realistic Kubernetes environment

When you run `kubeasy init`, the CLI:
1. Checks if a Kind cluster named `kubeasy` exists
2. Creates it if needed (single control-plane node)
3. Configures `kubectl` to point to this cluster
4. Installs ArgoCD and Kyverno

### 3. ArgoCD

[ArgoCD](https://argo-cd.readthedocs.io/) is a GitOps continuous delivery tool.

**Role in Kubeasy:**
- Deploys challenge manifests from the `challenges` repository
- Keeps the cluster state in sync with the desired challenge configuration
- Allows declarative, versioned challenge definitions

When you start a challenge:
```bash
kubeasy challenge start pod-evicted
```

The CLI creates an ArgoCD Application that pulls manifests from:
```
https://github.com/kubeasy-dev/challenges/tree/main/pod-evicted/manifests
```

### 4. Kyverno

[Kyverno](https://kyverno.io/) is a Kubernetes-native policy engine.

**Role in Kubeasy:**
- **Prevents bypasses** - Stops users from cheating (e.g., replacing broken app with working one)
- Enforces policies defined in each challenge's `policies/` folder

**Example bypass prevention:**
```yaml
# Prevents changing the container image
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: protect-challenge-image
spec:
  validationFailureAction: Enforce
  rules:
    - name: preserve-image
      match:
        resources:
          kinds: ["Deployment"]
          namespaces: ["challenge-*"]
      validate:
        message: "Cannot change the application image"
        pattern:
          spec:
            template:
              spec:
                containers:
                  - name: app
                    image: "kubeasy/broken-app:v1"
```

**Note:** Kyverno is NOT used for challenge validation. It only prevents bypasses. Validation is handled by the CLI.

### 5. CLI-Based Validation

Instead of a Kubernetes operator, Kubeasy uses **CLI-based validation**. The CLI reads validation definitions from `challenge.yaml` and executes checks directly against the cluster.

**Validation types:**

| Type | What it checks |
|------|----------------|
| `status` | Resource conditions (Pod Ready, Deployment Available) |
| `log` | Strings in container logs |
| `event` | Forbidden Kubernetes events (OOMKilled, Evicted) |
| `metrics` | Pod metrics (restart count) |
| `rbac` | ServiceAccount permissions |
| `connectivity` | HTTP connectivity between pods |

**Example validation definition:**
```yaml
# In challenge.yaml
validations:
  - key: pod-ready
    title: "Pod Ready"
    description: "The pod must be running"
    order: 1
    type: status
    spec:
      target:
        kind: Pod
        labelSelector:
          app: data-processor
      conditions:
        - type: Ready
          status: "True"
```

When you run `kubeasy challenge submit`, the CLI:
1. Loads validations from the challenge definition
2. Executes each validation against the cluster
3. Sends structured results to the backend
4. Backend verifies all expected objectives are present

## Challenge Lifecycle

Here's what happens during a typical challenge:

### Starting a Challenge

```bash
kubeasy challenge start pod-evicted
```

1. CLI fetches challenge metadata from the API
2. Creates an ArgoCD Application pointing to the challenge manifests
3. ArgoCD deploys resources into a dedicated namespace: `challenge-pod-evicted`
4. Kyverno policies are applied to prevent bypasses
5. Your `kubectl` context switches to this namespace

### Working on the Challenge

You now have full access to investigate and fix the problem:

```bash
kubectl get pods                    # Inspect resources
kubectl logs my-broken-pod          # Check logs
kubectl describe pod my-broken-pod  # See events
kubectl edit deployment my-app      # Make changes
```

The cluster behaves like a real Kubernetes environment. Use your debugging skills to find and fix the issue.

### Submitting a Solution

```bash
kubeasy challenge submit pod-evicted
```

1. CLI loads validations from `challenge.yaml`
2. Executes each validation against the cluster
3. Builds structured payload with per-validation results
4. Sends results to the Kubeasy backend
5. Backend verifies ALL objectives are present and passed
6. XP awarded if successful

### Resetting

```bash
kubeasy challenge reset pod-evicted
```

- Deletes the ArgoCD Application
- Removes the namespace and all resources
- Redeploys the challenge in its original broken state

## Data Flow Diagram

```
┌─────────────┐
│  User runs  │
│   CLI cmd   │
└──────┬──────┘
       │
       ▼
┌─────────────────┐
│  Kubeasy CLI    │
│  (Go binary)    │
└──────┬──────────┘
       │
       ├─────────────────────────────────┐
       │                                 │
       ▼                                 ▼
┌──────────────┐              ┌──────────────────┐
│   ArgoCD     │              │  CLI Validation  │
│   Deploys    │              │  Engine          │
│   Manifests  │              │  (executes       │
└──────┬───────┘              │   checks)        │
       │                      └────────┬─────────┘
       ▼                               │
┌─────────────────────────────────┐    │
│     Challenge Namespace          │◄───┘
│  (Isolated Kubernetes resources) │
└─────────────────────────────────┘
```

## Security & Isolation

Each challenge runs in its own namespace with:
- **RBAC restrictions**: You can only access your challenge namespace
- **Kyverno policies**: Prevent bypasses and cheating
- **Resource quotas**: Prevents resource exhaustion

The Kind cluster is entirely local:
- No data leaves your machine
- No cloud credentials required
- Full control over the environment

### Backend Security

The backend validates submissions by:
1. Checking ALL registered objectives are present (can't skip objectives)
2. Checking no unknown objectives are submitted (can't invent objectives)
3. Verifying each objective has `passed: true` for challenge completion

## What Gets Installed During Setup?

When you run `kubeasy init`, the CLI installs:

| Component | Purpose | Namespace |
|-----------|---------|-----------|
| ArgoCD | GitOps deployment | `argocd` |
| Kyverno | Bypass prevention | `kyverno` |

You can inspect these at any time:

```bash
kubectl get pods -n argocd
kubectl get pods -n kyverno
```

## Philosophy: Why CLI-Based Validation?

Previous versions of Kubeasy used:
1. Rego-based policies (complex, hard to write)
2. Kubernetes operator with CRDs (complex infrastructure)

The current CLI-based approach offers:
- **Simplicity** - One `challenge.yaml` file contains everything
- **No extra infrastructure** - CLI handles all validation logic
- **Easy testing** - Run validations locally without CRDs
- **Better error messages** - CLI provides detailed failure feedback
- **Faster iteration** - No operator reconciliation delays

## Further Reading

- [Kind Documentation](https://kind.sigs.k8s.io/)
- [ArgoCD Concepts](https://argo-cd.readthedocs.io/en/stable/core_concepts/)
- [Kyverno Policies](https://kyverno.io/policies/)
- [Challenge Structure](/docs/developer/challenge-structure)
- [Validation Rules](/docs/developer/validation-rules)
